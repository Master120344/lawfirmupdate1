<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading - The Kershaw Law Firm P.C.</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #003366;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: #f0f2f5;
            text-align: center;
            overflow: hidden;
        }
        .loading-container {
            padding: 20px;
        }
        .loading-container p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        .spinner {
            border: 5px solid rgba(240, 242, 245, 0.3);
            border-radius: 50%;
            border-top-color: #B08D57;
            width: 45px;
            height: 45px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px auto;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .noscript-message, .error-message {
            font-size: 1rem;
            margin-bottom: 10px;
        }
        .loading-container a {
            color: #B08D57;
            text-decoration: underline;
        }
        .loading-container a:hover {
            color: #d4b078;
        }
        .error-message {
            color: #ff4d4d;
            font-weight: bold;
        }
    </style>
    <script>
        (function() {
            'use strict';

            // Function to check if device is mobile
            function isMobileDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const mobilePatterns = /android|iphone|ipod|ipad|mobile|tablet|windows phone/i;
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                const isSmallScreen = window.matchMedia("(max-width: 768px)").matches;

                console.log('User Agent:', userAgent);
                console.log('Is Touch Device:', isTouchDevice);
                console.log('Is Small Screen:', isSmallScreen);

                return mobilePatterns.test(userAgent) || isTouchDevice || isSmallScreen;
            }

            // Function to verify if a URL exists
            async function checkUrlExists(url) {
                try {
                    const response = await fetch(url, { method: 'HEAD', cache: 'no-store' });
                    return response.ok;
                } catch (error) {
                    console.error('Error checking URL:', url, error);
                    return false;
                }
            }

            // Main redirect logic
            async function redirectToPage() {
                const isMobile = isMobileDevice();
                const baseUrl = window.location.origin + '/';
                const targetUrl = isMobile ? 'index_mobile.html' : 'index_desktop.html';
                const fullUrl = baseUrl + targetUrl;

                console.log('Target URL:', fullUrl);

                const urlExists = await checkUrlExists(fullUrl);
                if (urlExists) {
                    window.location.assign(fullUrl);
                } else {
                    console.error('Target URL not found:', fullUrl);
                    showErrorMessage(targetUrl);
                }
            }

            // Show error message if redirect fails
            function showErrorMessage(targetUrl) {
                const container = document.querySelector('.loading-container');
                container.innerHTML = `
                    <p class="error-message">Failed to load the ${targetUrl === 'index_mobile.html' ? 'mobile' : 'desktop'} version.</p>
                    <p>Please choose an option below:</p>
                    <p><a href="index_desktop.html">View Desktop Site</a></p>
                    <p><a href="index_mobile.html">View Mobile Site</a></p>
                `;
            }

            // Set a timeout to handle slow redirects
            const redirectTimeout = setTimeout(() => {
                console.error('Redirect timed out');
                showErrorMessage(isMobileDevice() ? 'index_mobile.html' : 'index_desktop.html');
            }, 5000);

            // Start redirect process
            redirectToPage().then(() => clearTimeout(redirectTimeout));
        })();
    </script>
</head>
<body>
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Determining the best experience for your device...</p>
        <noscript>
            <div class="noscript-message">
                <p>JavaScript is disabled. For the best experience, please enable JavaScript.</p>
                <p>Alternatively, choose a version below:</p>
                <p><a href="index_desktop.html">View Desktop Site</a></p>
                <p><a href="index_mobile.html">View Mobile Site</a></p>
            </div>
        </noscript>
    </div>
</body>
</html>
